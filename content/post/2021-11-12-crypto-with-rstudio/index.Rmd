---
title: Crypto with Rstudio
author: ''
date: '2021-11-12'
slug: crypto-with-rstudio
categories:
  - blockchain
tags:
  - blockchain
  - crypto
---

# Crypto2
Package `crypto2`  retrieves crypto currency information and historical prices as well as information on the exchanges they are listed on from (CoinMarketCap)<https://coinmarketcap.com> via their 'web-api'.
```{r}
library(crypto2)
library(tidyverse)

coins <- crypto_list(only_active=TRUE)
coin_info <- crypto_info(coins,limit=3)
coin_info
```
In addition we show tags provided by https://coinmarketcap.com.
```{r}
coin_info %>% 
  select(slug,tags) %>% 
  tidyr::unnest(tags) %>% 
  group_by(slug) %>% 
  slice(1,n())
```
Additionally: Here are some urls pertaining to these coins as provided by https://coinmarketcap.com.
```{r}
coin_info %>% 
  select(slug,urls) %>% 
  tidyr::unnest(urls) %>% 
  filter(name %in% c("reddit","twitter"))
```
In a next step we download time series data for these coins.
```{r}
# retrieve historical data for all (the first 3) of them
coin_hist <- crypto_history(coins, limit=3, start_date="20210101", end_date="20210105")
# and give the first two times of information per coin
coin_hist %>% 
  group_by(slug) %>% 
  slice(1:2)
```
Alternatively, we could determine the price of these coins in other currencies. A list of such currencies is available as fiat_list()
```{r}
fiats <- fiat_list()
fiats
```
So we download the time series again depicting prices in terms of Bitcoin and Euro (note that multiple currencies can be given to convert, separated by “,”).
```{r}
# retrieve historical data for all (the first 3) of them
coin_hist2 <- crypto_history(coins, convert="BTC,EUR", limit=3, start_date="20210101", end_date="20210105")

# and give the first two times of information per coin
coin_hist2 %>% 
  group_by(slug,ref_cur) %>% 
  slice(1:2)
```
Last and least, one can get information on exchanges. For this download a list of active/inactive/untracked exchanges using exchange_list():
```{r}
exchanges <- exchange_list(only_active=TRUE)
exchanges
```
and then download information on “binance” and “kraken”:
```{r}
ex_info <- exchange_info(exchanges %>% 
                           filter(slug %in% c('binance','kraken')))
ex_info
```
Then we can access information on the fee structure,
```{r}
ex_info %>% 
  select(contains("fee"))
```
the amount of cryptocurrencies being traded (in USD)
```{r}
ex_info %>% 
  select(contains("spot"))
```


# Tidyquant

```{r}
library(tidyquant)
```
```{r echo=FALSE}
tiingo_api_key('86771cb62164b5be7a3cbb13db57cf4c8ac4e251')
```
Candlestick Chart
```{r}
end = ymd(20211115)
# Tiingo Bitcoin in USD ----
btc_usd <- tq_get(c("btcusd"),
       get    = "tiingo.crypto",
       from   = "2020-01-01",
       to     = "2021-12-03")
 #,resample_frequency = "1day")
btc_usd %>% 
  # change the date format to `Date` for geom_candlestick. 
  mutate(date = as.Date(date)) %>% 
  ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close),
                      colour_up = "darkgreen", colour_down = "darkred", 
                      fill_up  = "darkgreen", fill_down  = "darkred")  +
    labs(title = "BTCUSD Candlestick Chart", y = "Closing Price", x = "") +
    theme_tq()

```
```{r}
eth_usd <- tq_get(c("ethusd"),
       get    = "tiingo.crypto",
       from   = "2021-09-01",
       to     = "2021-12-03")
 #,resample_frequency = "1day")
eth_usd %>% 
  # change the date format to `Date` for geom_candlestick. 
  mutate(date = as.Date(date)) %>% 
  ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close),
                      colour_up = "darkgreen", colour_down = "darkred", 
                      fill_up  = "darkgreen", fill_down  = "darkred")  +
    labs(title = "ETHUSD Candlestick Chart", y = "Closing Price", x = "") +
    theme_tq()

```

Pull AAPL stock price
```{r}
AAPL <- tq_get("AAPL", get = "stock.prices", 
               from = "2021-09-01", to = "2021-11-16")
```

```{r}


AAPL %>%
    ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close),
                        colour_up = "darkgreen", colour_down = "darkred", 
                        fill_up  = "darkgreen", fill_down  = "darkred", 
                     size = 1) +
    labs(title = "AAPL Candlestick Chart", 
         subtitle = "Zoomed in, Experimenting with Formatting",
         y = "Closing Price", x = "") + 
    coord_x_date(xlim = c(end - weeks(6), end),
                 ylim = c(130, 160)) + 
    theme_tq()
```
```{r}
eth_daily_log_returns <- eth_usd %>%
    tq_transmute(select     = close, 
                 mutate_fun = periodReturn, 
                 period     = "daily", 
                 type       = "log",
                 col_rename = "daily.returns")

eth_daily_log_returns %>% 
  mutate(pos = daily.returns > 0 ) %>% 
  ggplot(aes(x = date, y = daily.returns, fill = pos)) + 
    geom_col(position = "identity",  size = 0.25) +
    scale_fill_manual(values = c("#FFDDDD", "#CCEEFF"), guide = "none") +
    theme_bw()
```
```{r}
eth_daily_log_returns %>% 
  ggplot(aes(x = date, y = daily.returns)) +
  geom_barchart(aes(open = 0, high = daily.returns, low = 0, close = daily.returns))
```


