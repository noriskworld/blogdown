---
title: Crypto with Rstudio
author: ''
date: '2021-11-12'
slug: crypto-with-rstudio
categories:
  - blockchain
tags:
  - blockchain
  - crypto
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="crypto2" class="section level1">
<h1>Crypto2</h1>
<p>Package <code>crypto2</code> retrieves crypto currency information and historical prices as well as information on the exchanges they are listed on from (CoinMarketCap)<a href="https://coinmarketcap.com" class="uri">https://coinmarketcap.com</a> via their ‘web-api’.</p>
<pre class="r"><code>library(crypto2)
library(tidyverse)

coins &lt;- crypto_list(only_active=TRUE)
coin_info &lt;- crypto_info(coins,limit=3)</code></pre>
<pre><code>## &gt; Scraping crypto info
## &gt; Processing historical crypto data</code></pre>
<pre class="r"><code>coin_info</code></pre>
<pre><code>## # A tibble: 3 × 19
##      id name     symbol category description     slug   logo    subreddit notice
##   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt; 
## 1     1 Bitcoin  BTC    coin     &quot;## What Is Bi… bitco… https:… bitcoin   &quot;&quot;    
## 2     2 Litecoin LTC    coin     &quot;## What Is Li… litec… https:… litecoin  &quot;&quot;    
## 3     3 Namecoin NMC    coin     &quot;Namecoin (NMC… namec… https:… namecoin  &quot;&quot;    
## # … with 10 more variables: date_added &lt;chr&gt;, twitter_username &lt;chr&gt;,
## #   is_hidden &lt;int&gt;, date_launched &lt;lgl&gt;,
## #   self_reported_circulating_supply &lt;lgl&gt;, self_reported_tags &lt;lgl&gt;,
## #   status &lt;dttm&gt;, tags &lt;list&gt;, urls &lt;list&gt;, platform &lt;lgl&gt;</code></pre>
<p>In addition we show tags provided by <a href="https://coinmarketcap.com" class="uri">https://coinmarketcap.com</a>.</p>
<pre class="r"><code>coin_info %&gt;% 
  select(slug,tags) %&gt;% 
  tidyr::unnest(tags) %&gt;% 
  group_by(slug) %&gt;% 
  slice(1,n())</code></pre>
<pre><code>## # A tibble: 6 × 2
## # Groups:   slug [3]
##   slug     tags               
##   &lt;chr&gt;    &lt;chr&gt;              
## 1 bitcoin  mineable           
## 2 bitcoin  paradigm-portfolio 
## 3 litecoin mineable           
## 4 litecoin binance-smart-chain
## 5 namecoin mineable           
## 6 namecoin platform</code></pre>
<p>Additionally: Here are some urls pertaining to these coins as provided by <a href="https://coinmarketcap.com" class="uri">https://coinmarketcap.com</a>.</p>
<pre class="r"><code>coin_info %&gt;% 
  select(slug,urls) %&gt;% 
  tidyr::unnest(urls) %&gt;% 
  filter(name %in% c(&quot;reddit&quot;,&quot;twitter&quot;))</code></pre>
<pre><code>## # A tibble: 5 × 3
##   slug     name    url                                
##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                              
## 1 bitcoin  reddit  https://reddit.com/r/bitcoin       
## 2 litecoin twitter https://twitter.com/LitecoinProject
## 3 litecoin reddit  https://reddit.com/r/litecoin      
## 4 namecoin twitter https://twitter.com/Namecoin       
## 5 namecoin reddit  https://reddit.com/r/namecoin</code></pre>
<p>In a next step we download time series data for these coins.</p>
<pre class="r"><code># retrieve historical data for all (the first 3) of them
coin_hist &lt;- crypto_history(coins, limit=3, start_date=&quot;20210101&quot;, end_date=&quot;20210105&quot;)</code></pre>
<pre><code>## &gt; Scraping historical crypto data</code></pre>
<pre><code>## </code></pre>
<pre><code>## &gt; Processing historical crypto data</code></pre>
<pre><code>## </code></pre>
<pre class="r"><code># and give the first two times of information per coin
coin_hist %&gt;% 
  group_by(slug) %&gt;% 
  slice(1:2)</code></pre>
<pre><code>## # A tibble: 6 × 16
## # Groups:   slug [3]
##   timestamp           slug      id name   symbol ref_cur    open    high     low
##   &lt;dttm&gt;              &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 2021-01-02 23:59:59 bitco…     1 Bitco… BTC    USD     2.94e+4 3.32e+4 2.91e+4
## 2 2021-01-03 23:59:59 bitco…     1 Bitco… BTC    USD     3.21e+4 3.46e+4 3.21e+4
## 3 2021-01-02 23:59:59 litec…     2 Litec… LTC    USD     1.26e+2 1.40e+2 1.24e+2
## 4 2021-01-03 23:59:59 litec…     2 Litec… LTC    USD     1.37e+2 1.64e+2 1.36e+2
## 5 2021-01-02 23:59:59 namec…     3 Namec… NMC    USD     4.51e-1 5.10e-1 4.15e-1
## 6 2021-01-03 23:59:59 namec…     3 Namec… NMC    USD     4.26e-1 5.14e-1 4.25e-1
## # … with 7 more variables: close &lt;dbl&gt;, volume &lt;dbl&gt;, market_cap &lt;dbl&gt;,
## #   time_open &lt;dttm&gt;, time_close &lt;dttm&gt;, time_high &lt;dttm&gt;, time_low &lt;dttm&gt;</code></pre>
<p>Alternatively, we could determine the price of these coins in other currencies. A list of such currencies is available as fiat_list()</p>
<pre class="r"><code>fiats &lt;- fiat_list()
fiats</code></pre>
<pre><code>## # A tibble: 93 × 4
##       id name                 sign  symbol
##    &lt;int&gt; &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt; 
##  1  2781 United States Dollar $     USD   
##  2  2782 Australian Dollar    $     AUD   
##  3  2783 Brazilian Real       R$    BRL   
##  4  2784 Canadian Dollar      $     CAD   
##  5  2785 Swiss Franc          Fr    CHF   
##  6  2786 Chilean Peso         $     CLP   
##  7  2787 Chinese Yuan         ¥     CNY   
##  8  2788 Czech Koruna         Kč    CZK   
##  9  2789 Danish Krone         kr    DKK   
## 10  2790 Euro                 €     EUR   
## # … with 83 more rows</code></pre>
<p>So we download the time series again depicting prices in terms of Bitcoin and Euro (note that multiple currencies can be given to convert, separated by “,”).</p>
<pre class="r"><code># retrieve historical data for all (the first 3) of them
coin_hist2 &lt;- crypto_history(coins, convert=&quot;BTC,EUR&quot;, limit=3, start_date=&quot;20210101&quot;, end_date=&quot;20210105&quot;)</code></pre>
<pre><code>## &gt; Scraping historical crypto data</code></pre>
<pre><code>## </code></pre>
<pre><code>## &gt; Processing historical crypto data</code></pre>
<pre><code>## </code></pre>
<pre class="r"><code># and give the first two times of information per coin
coin_hist2 %&gt;% 
  group_by(slug,ref_cur) %&gt;% 
  slice(1:2)</code></pre>
<pre><code>## # A tibble: 12 × 16
## # Groups:   slug, ref_cur [6]
##    timestamp           slug      id name  symbol ref_cur    open    high     low
##    &lt;dttm&gt;              &lt;chr&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 2021-01-02 23:59:43 bitco…     1 Bitc… BTC    BTC     1   e+0 1.00e+0 9.99e-1
##  2 2021-01-03 23:59:41 bitco…     1 Bitc… BTC    BTC     1   e+0 1.00e+0 1.00e+0
##  3 2021-01-02 23:59:06 bitco…     1 Bitc… BTC    EUR     2.42e+4 2.73e+4 2.40e+4
##  4 2021-01-03 23:59:06 bitco…     1 Bitc… BTC    EUR     2.65e+4 2.85e+4 2.64e+4
##  5 2021-01-02 23:59:43 litec…     2 Lite… LTC    BTC     4.30e-3 4.24e-3 4.23e-3
##  6 2021-01-03 23:59:41 litec…     2 Lite… LTC    BTC     4.26e-3 4.93e-3 4.18e-3
##  7 2021-01-02 23:59:06 litec…     2 Lite… LTC    EUR     1.04e+2 1.16e+2 1.02e+2
##  8 2021-01-03 23:59:06 litec…     2 Lite… LTC    EUR     1.13e+2 1.34e+2 1.12e+2
##  9 2021-01-02 23:59:43 namec…     3 Name… NMC    BTC     1.54e-5 1.57e-5 1.31e-5
## 10 2021-01-03 23:59:41 namec…     3 Name… NMC    BTC     1.32e-5 1.52e-5 1.32e-5
## 11 2021-01-02 23:59:06 namec…     3 Name… NMC    EUR     3.71e-1 4.21e-1 3.41e-1
## 12 2021-01-03 23:59:06 namec…     3 Name… NMC    EUR     3.51e-1 4.24e-1 3.50e-1
## # … with 7 more variables: close &lt;dbl&gt;, volume &lt;dbl&gt;, market_cap &lt;dbl&gt;,
## #   time_open &lt;dttm&gt;, time_close &lt;dttm&gt;, time_high &lt;dttm&gt;, time_low &lt;dttm&gt;</code></pre>
<p>Last and least, one can get information on exchanges. For this download a list of active/inactive/untracked exchanges using exchange_list():</p>
<pre class="r"><code>exchanges &lt;- exchange_list(only_active=TRUE)
exchanges</code></pre>
<pre><code>## # A tibble: 438 × 6
##       id name         slug         is_active first_historical_… last_historical…
##    &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt; &lt;date&gt;             &lt;date&gt;          
##  1    16 Poloniex     poloniex             1 2018-04-26         2021-12-05      
##  2    22 Bittrex      bittrex              1 2018-04-26         2021-12-05      
##  3    24 Kraken       kraken               1 2018-04-26         2021-12-05      
##  4    32 Bleutrade    bleutrade            1 2018-04-26         2021-10-04      
##  5    34 Bittylicious bittylicious         1 2018-04-26         2021-12-05      
##  6    36 CEX.IO       cex-io               1 2018-04-26         2021-12-05      
##  7    37 Bitfinex     bitfinex             1 2018-04-26         2021-12-05      
##  8    42 HitBTC       hitbtc               1 2018-04-26         2021-12-05      
##  9    50 EXMO         exmo                 1 2018-04-26         2021-12-05      
## 10    61 Okcoin       okcoin               1 2018-04-26         2021-12-05      
## # … with 428 more rows</code></pre>
<p>and then download information on “binance” and “kraken”:</p>
<pre class="r"><code>ex_info &lt;- exchange_info(exchanges %&gt;% 
                           filter(slug %in% c(&#39;binance&#39;,&#39;kraken&#39;)))</code></pre>
<pre><code>## &gt; Scraping crypto info</code></pre>
<pre><code>## </code></pre>
<pre><code>## &gt; Processing historical crypto data</code></pre>
<pre><code>## </code></pre>
<pre class="r"><code>ex_info</code></pre>
<pre><code>## # A tibble: 2 × 19
##      id name    slug    description notice   logo  type  date_launched is_hidden
##   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;lgl&gt;       &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
## 1    24 Kraken  kraken  NA          &quot;&quot;       http… &quot;&quot;    2011-07-28T0…         0
## 2   270 Binance binance NA          &quot;Binanc… http… &quot;&quot;    2017-07-14T0…         0
## # … with 10 more variables: is_redistributable &lt;lgl&gt;, maker_fee &lt;dbl&gt;,
## #   taker_fee &lt;dbl&gt;, spot_volume_usd &lt;dbl&gt;, spot_volume_last_updated &lt;dttm&gt;,
## #   status &lt;dttm&gt;, tags &lt;lgl&gt;, urls &lt;list&gt;, countries &lt;lgl&gt;, fiats &lt;list&gt;</code></pre>
<p>Then we can access information on the fee structure,</p>
<pre class="r"><code>ex_info %&gt;% 
  select(contains(&quot;fee&quot;))</code></pre>
<pre><code>## # A tibble: 2 × 2
##   maker_fee taker_fee
##       &lt;dbl&gt;     &lt;dbl&gt;
## 1     -0.02     0.075
## 2      0.02     0.04</code></pre>
<p>the amount of cryptocurrencies being traded (in USD)</p>
<pre class="r"><code>ex_info %&gt;% 
  select(contains(&quot;spot&quot;))</code></pre>
<pre><code>## # A tibble: 2 × 2
##   spot_volume_usd spot_volume_last_updated
##             &lt;dbl&gt; &lt;dttm&gt;                  
## 1     3478524905. 2021-12-05 01:55:15     
## 2    56746762707. 2021-12-05 01:55:15</code></pre>
</div>
<div id="tidyquant" class="section level1">
<h1>Tidyquant</h1>
<pre class="r"><code>library(tidyquant)</code></pre>
<pre><code>## Token has been set for this R session only. It is recommended to instead set the `RIINGO_TOKEN` environment variable in an `.Renviron` file using `usethis::edit_r_environ()`, and then restart R.</code></pre>
<p>Candlestick Chart</p>
<pre class="r"><code>end = ymd(20211115)
# Tiingo Bitcoin in USD ----
btc_usd &lt;- tq_get(c(&quot;btcusd&quot;),
       get    = &quot;tiingo.crypto&quot;,
       from   = &quot;2020-01-01&quot;,
       to     = &quot;2021-12-03&quot;)
 #,resample_frequency = &quot;1day&quot;)
btc_usd %&gt;% 
  # change the date format to `Date` for geom_candlestick. 
  mutate(date = as.Date(date)) %&gt;% 
  ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close),
                      colour_up = &quot;darkgreen&quot;, colour_down = &quot;darkred&quot;, 
                      fill_up  = &quot;darkgreen&quot;, fill_down  = &quot;darkred&quot;)  +
    labs(title = &quot;BTCUSD Candlestick Chart&quot;, y = &quot;Closing Price&quot;, x = &quot;&quot;) +
    theme_tq()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>eth_usd &lt;- tq_get(c(&quot;ethusd&quot;),
       get    = &quot;tiingo.crypto&quot;,
       from   = &quot;2021-09-01&quot;,
       to     = &quot;2021-12-03&quot;)
 #,resample_frequency = &quot;1day&quot;)
eth_usd %&gt;% 
  # change the date format to `Date` for geom_candlestick. 
  mutate(date = as.Date(date)) %&gt;% 
  ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close),
                      colour_up = &quot;darkgreen&quot;, colour_down = &quot;darkred&quot;, 
                      fill_up  = &quot;darkgreen&quot;, fill_down  = &quot;darkred&quot;)  +
    labs(title = &quot;ETHUSD Candlestick Chart&quot;, y = &quot;Closing Price&quot;, x = &quot;&quot;) +
    theme_tq()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Pull AAPL stock price</p>
<pre class="r"><code>AAPL &lt;- tq_get(&quot;AAPL&quot;, get = &quot;stock.prices&quot;, 
               from = &quot;2021-09-01&quot;, to = &quot;2021-11-16&quot;)</code></pre>
<pre><code>## Warning: `type_convert()` only converts columns of type &#39;character&#39;.
## - `df` has no columns of type &#39;character&#39;</code></pre>
<pre class="r"><code>AAPL %&gt;%
    ggplot(aes(x = date, y = close)) +
    geom_candlestick(aes(open = open, high = high, low = low, close = close),
                        colour_up = &quot;darkgreen&quot;, colour_down = &quot;darkred&quot;, 
                        fill_up  = &quot;darkgreen&quot;, fill_down  = &quot;darkred&quot;, 
                     size = 1) +
    labs(title = &quot;AAPL Candlestick Chart&quot;, 
         subtitle = &quot;Zoomed in, Experimenting with Formatting&quot;,
         y = &quot;Closing Price&quot;, x = &quot;&quot;) + 
    coord_x_date(xlim = c(end - weeks(6), end),
                 ylim = c(130, 160)) + 
    theme_tq()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="672" />
We can create the Daily log return chart.</p>
<pre class="r"><code>eth_daily_log_returns &lt;- eth_usd %&gt;%
    tq_transmute(select     = close, 
                 mutate_fun = periodReturn, 
                 period     = &quot;daily&quot;, 
                 type       = &quot;log&quot;,
                 col_rename = &quot;daily.returns&quot;)</code></pre>
<pre><code>## Warning: `type_convert()` only converts columns of type &#39;character&#39;.
## - `df` has no columns of type &#39;character&#39;</code></pre>
<pre class="r"><code>eth_daily_log_returns %&gt;% 
  mutate(pos = daily.returns &gt; 0 ) %&gt;% 
  ggplot(aes(x = date, y = daily.returns, fill = pos)) + 
    geom_col(position = &quot;identity&quot;,  size = 0.25) +
    scale_fill_manual(values = c(&quot;#FFDDDD&quot;, &quot;#CCEEFF&quot;), guide = &quot;none&quot;) +
    theme_bw()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-17-1.png" width="672" />
Or, use the <code>tidyquant::geom_barchart</code>:</p>
<pre class="r"><code>eth_daily_log_returns %&gt;% 
  ggplot(aes(x = date, y = daily.returns)) +
  geom_barchart(aes(open = 0, high = daily.returns, low = 0, close = daily.returns))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
